<div class="p-6 bg-[#f8fafc] min-h-screen">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-[#1e3a8a]">
      <h3 class="text-gray-400 text-sm font-medium uppercase">Active Targets</h3>
      <p class="text-3xl font-black text-gray-800 mt-2">{{ filteredTargets().length }}</p>
    </div>
    <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-amber-500">
      <h3 class="text-gray-400 text-sm font-medium uppercase">Total Yearly target</h3>
      <p class="text-3xl font-black text-gray-800 mt-2">{{ totalTargetAmount() | currency:'USD ':'symbol':'1.0-0' }}</p>
    </div>
  </div>

  <div class="bg-white p-4 rounded-xl shadow-sm mb-6 border border-gray-100 flex flex-wrap gap-4 items-end">
    <div class="flex-1 min-w-[200px]">
      <label class="text-[10px] font-black text-gray-400 uppercase mb-1 block">Search Product</label>
      <input type="text" [ngModel]="searchText()" (ngModelChange)="searchText.set($event)" placeholder="Search..."
        class="w-full bg-slate-50 border-0 rounded-lg px-4 py-2 focus:ring-2 focus:ring-[#1e3a8a] outline-none">
    </div>
    <div class="w-48">
      <label class="text-[10px] font-black text-gray-400 uppercase mb-1 block">Fiscal Year</label>
      <select [ngModel]="selectedYear()" (ngModelChange)="selectedYear.set($event)"
        class="w-full bg-slate-50 border-0 rounded-lg px-3 py-2 outline-none">
        <option [ngValue]="null">All Years</option>
        @for (year of yearsList(); track year) {
          <option [ngValue]="year">{{ year }}</option>
        }
      </select>
    </div>
    <button (click)="openModal()"
      class="bg-[#1e3a8a] text-white px-6 py-2 rounded-lg font-bold shadow-md hover:bg-blue-900 transition">+ Add Target</button>
  </div>

  <div class="bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100">
    <table class="w-full text-left border-collapse">
      <thead class="bg-slate-50 text-[10px] text-gray-400 font-black uppercase tracking-widest border-b border-slate-100">
        <tr>
          <th class="p-5">Product Name</th>
          <th class="p-5 text-center">Year</th>
          <th class="p-5 text-right">Annual Target</th>
          <th class="p-5 text-center">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-50 text-sm">
        @for (item of filteredTargets(); track item.id) {
        <tr class="hover:bg-blue-50/50 transition duration-150">
          <td class="p-5 font-bold text-slate-700">{{ dataService.getProductName(item.product_id) }}</td>
          <td class="p-5 text-center">
            <span class="bg-slate-100 px-3 py-1 rounded-full text-xs font-bold text-slate-600">{{ item.year }}</span>
          </td>
          <td class="p-5 text-right font-black text-[#1e3a8a]">{{ item.annual_target | currency:'USD ':'symbol':'1.0-0' }}</td>
          <td class="p-5 text-center">
            <button (click)="editItem(item)" class="text-slate-400 hover:text-[#1e3a8a] transition">
              <span class="material-icons text-base">edit</span>
            </button>
          </td>
        </tr>
        }
        @empty {
        <tr>
          <td colspan="4" class="p-10 text-center text-slate-400 italic">No targets found.</td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>

@if (showModal) {
<div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
  <div class="bg-white p-8 rounded-[2rem] w-full max-w-md shadow-2xl animate-fade-in">
    <div class="flex justify-between items-center mb-6">
      <h3 class="font-black text-xl text-slate-800 uppercase tracking-tight">
        {{ isEditMode ? 'Update Target' : 'New Target' }}
      </h3>
      <button (click)="showModal=false" class="text-slate-400 hover:text-rose-500 transition">
        <span class="material-icons">close</span>
      </button>
    </div>

    <div class="space-y-4">
      <div>
        <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">Product</label>
        <select [(ngModel)]="currentItem.product_id"
          class="w-full p-3 bg-slate-50 rounded-xl border-0 outline-none focus:ring-2 focus:ring-[#1e3a8a]">
          @for (p of dataService.products(); track p.product_id) {
          <option [value]="p.product_id">{{ p.product_name }}</option>
          }
        </select>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">Year</label>
          <select [(ngModel)]="currentItem.year"
            class="w-full p-3 bg-slate-50 rounded-xl border-0 focus:ring-2 focus:ring-[#1e3a8a] outline-none">
            @for (year of yearsList(); track year) {
              <option [value]="year">{{ year }}</option>
            }
          </select>
        </div>
        <div>
          <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">Value ($)</label>
          <input type="number" [(ngModel)]="currentItem.annual_target"
            class="w-full p-3 bg-slate-50 rounded-xl border-0 font-bold focus:ring-2 focus:ring-[#1e3a8a] outline-none">
        </div>
      </div>
    </div>
    <div class="mt-8 flex gap-3">
      <button (click)="showModal=false"
        class="flex-1 py-3 text-slate-400 font-bold uppercase text-[10px] tracking-widest hover:bg-slate-50 rounded-xl transition">Cancel</button>
      <button (click)="save()"
        class="flex-[2] py-3 bg-[#1e3a8a] text-white rounded-xl font-black shadow-lg shadow-blue-200 uppercase text-[10px] tracking-widest hover:bg-blue-900 transition">
        {{ isEditMode ? 'Update target' : 'Save target' }}
      </button>
    </div>
  </div>
</div>
}
